{% extends "base_generic.html" %}
{% block title %}Dashboard{% endblock %}

{% block content %}

<!-- ØªØ±Ø­ÙŠØ¨ -->
<div class="row mb-4">
  <div class="col">
    <h3>Ù…Ø±Ø­Ø¨Ù‹Ø§ {{ request.user.username }} ğŸ‘‹</h3>
    <p class="text-muted">Ø¯ÙŠ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø®Ø§ØµØ© Ø¨ÙŠÙƒ</p>
  </div>
</div>

{% if messages and request.path == '/accounts/dashboard/' %}
  <ul>
    {% for message in messages %}
      <li>{{ message }}</li>
    {% endfor %}
  </ul>
{% endif %}


<!--Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†-->
{% if user.is_superuser %}
    <div class="row mb-4">
      <div class="col">
        <h3> {{ total_users }} ğŸ‘‹</h3>
        <p class="text-muted"> Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</p>
      </div>
    </div>

{% endif %}

<!--Ø¹Ø¯Ø¯ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯Ø§Øª-->
 {% if user.is_superuser %}
  <h3>Ø¹Ø¯Ø¯ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯Ø§Øª Ù„ÙƒÙ„ Ù…Ø³ØªØ®Ø¯Ù…:</h3>
  <ul>
    {% for u in users_with_barcodes %}
      <li>{{ u.username }} : {{ u.barcode_count }}</li>
    {% endfor %}
  </ul>

{% endif %}


<!-- ÙƒØ±ÙˆØª Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª -->
<div class="row g-4">

  <!-- Ø¹Ø¯Ø¯ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯Ø§Øª -->
  <div class="col-md-4">
    <div class="card shadow-sm border-0">
      <div class="card-body text-center">
        <h6 class="text-muted">Ø¹Ø¯Ø¯ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯Ø§Øª</h6>
        <h1 class="fw-bold">{{ all_barcode }}</h1>
      </div>
    </div>
  </div>

  <!-- Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø³Ø­Ø§Øª -->
  <div class="col-md-4">
    <div class="card shadow-sm border-0 bg-info text-white">
      <div class="card-body text-center">
        <h6>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³Ø­Ø§Øª</h6>
        
        
        
        <h1 class="fw-bold">{{ total_scans}}</h1>
        
      </div>
    </div>
  </div>

  <!-- Ø¥Ù†Ø´Ø§Ø¡ Ø¨Ø§Ø±ÙƒÙˆØ¯ -->
  <div class="col-md-4">
    <div class="card shadow-sm border-0 bg-success text-white">
      <div class="card-body text-center">
        <h6>Ø¥Ù†Ø´Ø§Ø¡ Ø¨Ø§Ø±ÙƒÙˆØ¯ Ø¬Ø¯ÙŠØ¯</h6>
        <p class="small">Ø£Ù†Ø´Ø¦ Ø¨Ø§Ø±ÙƒÙˆØ¯Ùƒ Ø®Ù„Ø§Ù„ Ø«ÙˆØ§Ù†ÙŠ</p>
        <a href="{% url 'barcode_app:create_barcode' %}" class="btn btn-light btn-sm w-100">
          â• Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¢Ù†
        </a>
      </div>
    </div>
  </div>

</div>

<hr class="my-5">

<!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯Ø§Øª -->
<div class="card shadow-sm border-0">
  <div class="card-body">
    <h5 class="mb-3">Ø¨Ø§Ø±ÙƒÙˆØ¯Ø§ØªÙŠ</h5>

    {% if barcodes %}
    <div class="table-responsive">
      <table class="table table-hover align-middle text-center">
        <thead class="table-light">
          <tr>
            <th>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th>
            <th>Ø§Ù„Ù†ÙˆØ¹</th>
            <th>Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©</th>
            <th>ØªØ­Ù…ÙŠÙ„</th>
            <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡</th>
            <th>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³Ø­Ø§Øª</th>
            <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
          </tr>
        </thead>
        <tbody>
          {% for barcode in barcodes %}
          <tr>
            <td>{{ barcode.title }}</td>
            <td>{{ barcode.get_type_display }}</td>

            <!-- Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© -->
            <td>
              {% if barcode.type == 'link' %}
                <img
                  src="{{ barcode.qr_code.url }}"
                  class="img-thumbnail barcode-img"
                  width="80"
                  data-bs-toggle="modal"
                  data-bs-target="#previewModal"
                  onclick="showPreview('{{ barcode.qr_code.url }}')"
                >
              {% elif barcode.type == 'product' %}
                <a href="{% url 'barcode_app:scan_barcode' barcode.id %}">
                  <img
                    src="{{ barcode.qr_code.url }}"
                    class="img-thumbnail barcode-img"
                    width="80"
                  >
                </a>
              {% endif %}
            </td>

            <!-- ØªØ­Ù…ÙŠÙ„ -->
            {% if barcode.qr_code %}
                <td>
                  <a href="{{ barcode.qr_code.url }}" target="_blank">
                    <img
                      src="{{ barcode.qr_code.url }}"
                      class="img-thumbnail barcode-img"
                      width="80"
                    >
                  </a>
                </td>

                <td>
                  <a href="{{ barcode.qr_code.url }}" download
                    class="btn btn-sm btn-outline-success">
                    ØªØ­Ù…ÙŠÙ„
                  </a>
                </td>
              {% else %}
                <td colspan="2" class="text-muted text-center">
                  Ù„Ø§ ÙŠÙˆØ¬Ø¯ QR Ø¨Ø¹Ø¯
                </td>
              {% endif %}


            <!-- Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³Ø­Ø§Øª Ù„ÙƒÙ„ Ø¨Ø§Ø±ÙƒÙˆØ¯ -->
            <td>{{ barcode.scans}}</td> 
            <div class="card-body p-0">
       
    </div>

            <!-- Ø­Ø°Ù -->
            <td>
              <form method="post"
                    action="{% url 'barcode_app:delete_barcode' barcode.id %}"
                    onsubmit="return confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ØŸ');">
                {% csrf_token %}
                <button type="submit" class="btn btn-sm btn-outline-danger">
                  ğŸ—‘ï¸ Ø­Ø°Ù
                </button>
              </form>
            </td>

          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% else %}
      <!-- Empty State -->
      <div class="text-center py-5">
        <h5 class="text-muted">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¨Ø§Ø±ÙƒÙˆØ¯Ø§Øª Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†</h5>
        <p class="small text-muted">Ø§Ø¨Ø¯Ø£ Ø¨Ø¥Ù†Ø´Ø§Ø¡ Ø£ÙˆÙ„ Ø¨Ø§Ø±ÙƒÙˆØ¯ Ø®Ø§Øµ Ø¨Ùƒ</p>
        <a href="{% url 'barcode_app:create_barcode' %}" class="btn btn-success">
          Ø¥Ù†Ø´Ø§Ø¡ Ø£ÙˆÙ„ Ø¨Ø§Ø±ÙƒÙˆØ¯
        </a>
      </div>
    {% endif %}

  </div>
</div>

<!-- Modal Preview -->
<div class="modal fade" id="previewModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">

      <div class="modal-header">
        <h5 class="modal-title">Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body text-center">
        <img id="previewImage" src="" class="img-fluid rounded shadow">
      </div>

    </div>
  </div>
</div>

<!-- JS -->
<script>
function showPreview(imageUrl) {
  document.getElementById("previewImage").src = imageUrl;
}
</script>

<!-- CSS -->
<style>
.barcode-img {
  cursor: pointer;
  transition: transform 0.2s ease;
}
.barcode-img:hover {
  transform: scale(1.1);
}
</style>

{% endblock %}  


